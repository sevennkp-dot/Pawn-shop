<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ระบบรับซื้อ / รับฝาก</title>
  <style>
    body { font-family: Tahoma, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
    h1,h2 { color:#333; }
    .card { background:#fff; padding:20px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    label { display:block; margin-top:10px; font-weight:bold; }
    input, select, textarea { width:100%; padding:8px; margin-top:5px; }
    button { margin-top:15px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; }
    .primary { background:#2563eb; color:#fff; }
    .secondary { background:#16a34a; color:#fff; }
    .warning { background:#f59e0b; color:#fff; }
    .status { font-weight:bold; padding:10px; }
    .approved { color:green; }
    .pending { color:orange; }
  </style>
</head>
<body>

<h1>หน้าเลือกการทำงาน</h1>

<div class="card">
  <h2>ขออนุมัติจากผู้ดูแลระบบ</h2>

  <label>รับซื้อหรือฝาก</label>
  <select id="dealType">
    <option value="">-- เลือก --</option>
    <option value="buy">รับซื้อ</option>
    <option value="pawn">รับฝาก</option>
  </select>

  <button class="primary" onclick="approve()">ส่งขออนุมัติ</button>
  <div id="approvalStatus" class="status pending">สถานะ: รออนุมัติ</div>
</div>

<!-- ================= รับซื้อ ================= -->
<div class="card" id="buySection" style="display:none;">
  <h2>รับซื้อ (เมื่ออนุมัติ)</h2>

  <label>วันที่ทำการซื้อขาย</label>
  <input type="date" id="buyDate">

  <label>เลขที่บิล</label>
  <input type="text" id="buyBill" readonly>

  <label>ชื่อ-นามสกุล</label>
  <input type="text" id="buyName">

  <label>ประเภทสินค้า</label>
  <input type="text" id="buyType">

  <label>รุ่น</label>
  <input type="text" id="buyModel">

  <label>ยี่ห้อ</label>
  <input type="text" id="buyBrand">

  <label>Serial Number</label>
  <input type="text" id="buySerial">

  <label>IMEI / Part</label>
  <input type="text" id="buyImei">

  <label>สุขภาพแบต (%)</label>
  <input type="number" id="buyBattery">

  <label>ตำหนิ / บันทึกเพิ่มเติม</label>
  <textarea id="buyNote"></textarea>

  <label>รูปถ่ายจริง (6 รูป)</label>
  <input type="file" multiple accept="image/*">

  <button class="secondary" onclick="printReceipt()">พิมพ์ใบเสร็จ</button>
</div>

<!-- ================= รับฝาก ================= -->
<div class="card" id="pawnSection" style="display:none;">
  <h2>รับฝาก (เมื่ออนุมัติ)</h2>

  <label>เลขที่บิล</label>
  <input type="text" id="pawnBill" readonly>

  <label>ชื่อ-นามสกุล</label>
  <input type="text" id="pawnName">

  <label>ที่อยู่</label>
  <textarea id="pawnAddress"></textarea>

  <label>เบอร์โทร</label>
  <input type="tel" id="pawnPhone">

  <label>ประเภทสินค้า</label>
  <input type="text" id="pawnType">

  <label>รุ่น</label>
  <input type="text" id="pawnModel">

  <label>ยี่ห้อ</label>
  <input type="text" id="pawnBrand">

  <label>Serial Number</label>
  <input type="text" id="pawnSerial">

  <label>IMEI / Part</label>
  <input type="text" id="pawnImei">

  <label>สุขภาพแบต (%)</label>
  <input type="number" id="pawnBattery">

  <label>ตำหนิ / บันทึกเพิ่มเติม</label>
  <textarea id="pawnNote"></textarea>

  <label>รูปถ่ายจริง (6 รูป)</label>
  <input type="file" multiple accept="image/*">

  <label>ราคาขายฝาก</label>
  <input type="number" id="pawnPrice" oninput="calculateFee()">

  <label>ระยะเวลาชำระ</label>
  <select id="term" onchange="calculateFee()">
    <option value="">-- เลือก --</option>
    <option value="20">20 วัน (ค่าบริการ 7%)</option>
    <option value="15">15 วัน (ค่าบริการ 10%)</option>
  </select>

  <div class="status" id="feeResult">ค่าบริการ: -</div>
  <div class="status" id="dueDate">วันครบกำหนด: -</div>

  <button class="secondary" onclick="printContract()">พิมพ์สัญญา</button>
  <button class="warning" onclick="printAppointment()">พิมพ์ใบนัดชำระ</button>
</div>

<script>
function randomBill() {
  return 'B' + Date.now() + Math.floor(Math.random() * 100);
}

function approve() {
  const type = document.getElementById('dealType').value;
  document.getElementById('approvalStatus').innerText = 'สถานะ: อนุมัติแล้ว';
  document.getElementById('approvalStatus').className = 'status approved';

  if (type === 'buy') {
    document.getElementById('buySection').style.display = 'block';
    document.getElementById('buyBill').value = randomBill();
  }
  if (type === 'pawn') {
    document.getElementById('pawnSection').style.display = 'block';
    document.getElementById('pawnBill').value = randomBill();
  }
}

function calculateFee() {
  const price = Number(document.getElementById('pawnPrice').value || 0);
  const term = document.getElementById('term').value;
  let rate = 0;
  if (term === '20') rate = 0.07;
  if (term === '15') rate = 0.10;

  const fee = price * rate;
  document.getElementById('feeResult').innerText = 'ค่าบริการ: ' + fee.toFixed(2) + ' บาท';

  if (term) {
    const d = new Date();
    d.setDate(d.getDate() + Number(term));
    document.getElementById('dueDate').innerText = 'วันครบกำหนด: ' + d.toLocaleDateString('th-TH');
  } else {
    document.getElementById('dueDate').innerText = 'วันครบกำหนด: -';
  }
}

function printContract() {
  const win = window.open('', '_blank');
  if (!win) return alert('กรุณาอนุญาต popup');
  win.document.write('<h1>สัญญาขายฝาก</h1><p>เลขที่บิล: ' + document.getElementById('pawnBill').value + '</p>');
  win.print();
}

function printAppointment() {
  const win = window.open('', '_blank');
  if (!win) return alert('กรุณาอนุญาต popup');
  win.document.write('<h2>ใบนัดชำระ</h2><p>' + document.getElementById('dueDate').innerText + '</p>');
  win.print();
}

function printReceipt() {
  const win = window.open('', '_blank');
  if (!win) return alert('กรุณาอนุญาต popup');
  win.document.write('<h2>ใบเสร็จรับเงิน</h2><p>เลขที่บิล: ' + document.getElementById('buyBill').value + '</p>');
  win.print();
}
</script>

</body>
</html>
